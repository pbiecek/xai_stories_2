<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 The most seasonal products | XAI Stories 2.0</title>
  <meta name="description" content="eXplainable Artificial Intelligence for Retail Analytics" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 The most seasonal products | XAI Stories 2.0" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/images/cover.png" />
  <meta property="og:description" content="eXplainable Artificial Intelligence for Retail Analytics" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 The most seasonal products | XAI Stories 2.0" />
  
  <meta name="twitter:description" content="eXplainable Artificial Intelligence for Retail Analytics" />
  <meta name="twitter:image" content="/images/cover.png" />



<meta name="date" content="2021-06-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction-1.html"/>
<link rel="next" href="model-for-predicting-future-sales.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>



<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><h3>XAI Stories 2.0</h3> Case studies for retail analytics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="foreword.html"><a href="foreword.html"><i class="fa fa-check"></i>Foreword</a>
<ul>
<li class="chapter" data-level="0.1" data-path="foreword.html"><a href="foreword.html#why"><i class="fa fa-check"></i><b>0.1</b> Why?</a></li>
<li class="chapter" data-level="0.2" data-path="foreword.html"><a href="foreword.html#what"><i class="fa fa-check"></i><b>0.2</b> What?</a></li>
<li class="chapter" data-level="0.3" data-path="foreword.html"><a href="foreword.html#how"><i class="fa fa-check"></i><b>0.3</b> How?</a></li>
<li class="chapter" data-level="0.4" data-path="foreword.html"><a href="foreword.html#about-academic-partners"><i class="fa fa-check"></i><b>0.4</b> About academic partners</a></li>
<li class="chapter" data-level="0.5" data-path="foreword.html"><a href="foreword.html#about-business-partner"><i class="fa fa-check"></i><b>0.5</b> About business partner</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="team-1.html"><a href="team-1.html"><i class="fa fa-check"></i><b>1</b> Team 1</a>
<ul>
<li class="chapter" data-level="1.1" data-path="team-1.html"><a href="team-1.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="team-1.html"><a href="team-1.html#model"><i class="fa fa-check"></i><b>1.2</b> Model</a></li>
<li class="chapter" data-level="1.3" data-path="team-1.html"><a href="team-1.html#explanations"><i class="fa fa-check"></i><b>1.3</b> Explanations</a></li>
<li class="chapter" data-level="1.4" data-path="team-1.html"><a href="team-1.html#summary-and-conclusions"><i class="fa fa-check"></i><b>1.4</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="team-2.html"><a href="team-2.html"><i class="fa fa-check"></i><b>2</b> Team 2</a></li>
<li class="chapter" data-level="3" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i><b>3</b> Introduction</a></li>
<li class="chapter" data-level="4" data-path="the-most-seasonal-products.html"><a href="the-most-seasonal-products.html"><i class="fa fa-check"></i><b>4</b> The most seasonal products</a>
<ul>
<li class="chapter" data-level="4.0.1" data-path="the-most-seasonal-products.html"><a href="the-most-seasonal-products.html#data-representation"><i class="fa fa-check"></i><b>4.0.1</b> Data representation</a></li>
<li class="chapter" data-level="4.0.2" data-path="the-most-seasonal-products.html"><a href="the-most-seasonal-products.html#seasonality-measure"><i class="fa fa-check"></i><b>4.0.2</b> Seasonality measure</a></li>
<li class="chapter" data-level="4.0.3" data-path="the-most-seasonal-products.html"><a href="the-most-seasonal-products.html#what-kind-of-seasonality"><i class="fa fa-check"></i><b>4.0.3</b> What kind of seasonality?</a></li>
<li class="chapter" data-level="4.0.4" data-path="the-most-seasonal-products.html"><a href="the-most-seasonal-products.html#the-most-seasonal-products-1"><i class="fa fa-check"></i><b>4.0.4</b> The most seasonal products</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="model-for-predicting-future-sales.html"><a href="model-for-predicting-future-sales.html"><i class="fa fa-check"></i><b>5</b> Model for predicting future sales</a></li>
<li class="chapter" data-level="6" data-path="model-explanation.html"><a href="model-explanation.html"><i class="fa fa-check"></i><b>6</b> Model Explanation</a></li>
<li class="chapter" data-level="7" data-path="data-preprocessing.html"><a href="data-preprocessing.html"><i class="fa fa-check"></i><b>7</b> Data preprocessing</a></li>
<li class="chapter" data-level="8" data-path="team-3.html"><a href="team-3.html"><i class="fa fa-check"></i><b>8</b> Team 3</a>
<ul>
<li class="chapter" data-level="8.1" data-path="team-3.html"><a href="team-3.html#introduction-2"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="team-3.html"><a href="team-3.html#model-1"><i class="fa fa-check"></i><b>8.2</b> Model</a></li>
<li class="chapter" data-level="8.3" data-path="team-3.html"><a href="team-3.html#explanations-1"><i class="fa fa-check"></i><b>8.3</b> Explanations</a></li>
<li class="chapter" data-level="8.4" data-path="team-3.html"><a href="team-3.html#summary-and-conclusions-1"><i class="fa fa-check"></i><b>8.4</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html"><i class="fa fa-check"></i><b>9</b> Story Sales Prediction</a>
<ul>
<li class="chapter" data-level="9.1" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#introduction-3"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#data"><i class="fa fa-check"></i><b>9.2</b> Data</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#overview"><i class="fa fa-check"></i><b>9.2.1</b> Overview</a></li>
<li class="chapter" data-level="9.2.2" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#assigning-missing-categories"><i class="fa fa-check"></i><b>9.2.2</b> Assigning missing categories</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#long-term-sales-forecasting"><i class="fa fa-check"></i><b>9.3</b> Long-term sales forecasting</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#model-description"><i class="fa fa-check"></i><b>9.3.1</b> Model description</a></li>
<li class="chapter" data-level="9.3.2" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#model-explanations"><i class="fa fa-check"></i><b>9.3.2</b> Model explanations</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#short-term-sales-forecasting"><i class="fa fa-check"></i><b>9.4</b> Short-term sales forecasting</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#models-description"><i class="fa fa-check"></i><b>9.4.1</b> Models’ description</a></li>
<li class="chapter" data-level="9.4.2" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#results"><i class="fa fa-check"></i><b>9.4.2</b> Results</a></li>
<li class="chapter" data-level="9.4.3" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#models-explanations"><i class="fa fa-check"></i><b>9.4.3</b> Models’ explanations</a></li>
<li class="chapter" data-level="9.4.4" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#why-dont-we-use-short-term-regression-model-instead"><i class="fa fa-check"></i><b>9.4.4</b> Why don’t we use short-term regression model instead</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#summary-and-conclusions-2"><i class="fa fa-check"></i><b>9.5</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="temperature-vs-sales-prediction.html"><a href="temperature-vs-sales-prediction.html"><i class="fa fa-check"></i><b>10</b> Temperature vs sales prediction</a>
<ul>
<li class="chapter" data-level="10.1" data-path="temperature-vs-sales-prediction.html"><a href="temperature-vs-sales-prediction.html#introduction-4"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="temperature-vs-sales-prediction.html"><a href="temperature-vs-sales-prediction.html#model-2"><i class="fa fa-check"></i><b>10.2</b> Model</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="temperature-vs-sales-prediction.html"><a href="temperature-vs-sales-prediction.html#product-categories"><i class="fa fa-check"></i><b>10.2.1</b> Product Categories</a></li>
<li class="chapter" data-level="10.2.2" data-path="temperature-vs-sales-prediction.html"><a href="temperature-vs-sales-prediction.html#training-and-testing-procedure"><i class="fa fa-check"></i><b>10.2.2</b> Training and testing procedure</a></li>
<li class="chapter" data-level="10.2.3" data-path="temperature-vs-sales-prediction.html"><a href="temperature-vs-sales-prediction.html#evaluated-models"><i class="fa fa-check"></i><b>10.2.3</b> Evaluated models</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="temperature-vs-sales-prediction.html"><a href="temperature-vs-sales-prediction.html#explanations-2"><i class="fa fa-check"></i><b>10.3</b> Explanations</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="temperature-vs-sales-prediction.html"><a href="temperature-vs-sales-prediction.html#instance-level-explanations-1"><i class="fa fa-check"></i><b>10.3.1</b> Instance-level explanations</a></li>
<li class="chapter" data-level="10.3.2" data-path="temperature-vs-sales-prediction.html"><a href="temperature-vs-sales-prediction.html#model-level-explanations"><i class="fa fa-check"></i><b>10.3.2</b> Model-level explanations</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="temperature-vs-sales-prediction.html"><a href="temperature-vs-sales-prediction.html#summary-and-conclusions-3"><i class="fa fa-check"></i><b>10.4</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">XAI Stories 2.0</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-most-seasonal-products" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> The most seasonal products</h1>
<div id="data-representation" class="section level3" number="4.0.1">
<h3><span class="header-section-number">4.0.1</span> Data representation</h3>
<p>Before doing any further analysis, we grouped similar products as one cluster. It is described in greater details in the section Data preprocessing but here we give just some examples:</p>
<p>group <strong>zestaw wypoczynkowy</strong> contains<br />
* Zestaw wypoczynkowy, 14 elementów, naturalny rattan
* Zestaw wypoczynkowy, 27 elementów, naturalny rattan<br />
* 6-cz. zestaw wypoczynkowy do ogrodu, poduszki, rat
* and many many more</p>
<p>group <strong>stolik krzesła</strong> contains:
* Stolik i krzesła barowe, 3 elementy, drewno’,
* Stolik i krzesła barowe, 5 elementów, lite drewno akacjowe’,
* Stolik i 2 krzesła z mozaiką niebiesko-białą’,
* and many many more</p>
</div>
<div id="seasonality-measure" class="section level3" number="4.0.2">
<h3><span class="header-section-number">4.0.2</span> Seasonality measure</h3>
<p>Now we would like to measure which of these groups exhibit the strongest seasonality in terms of number of sales. We use the seasonality measure which is described here [<a href="https://otexts.com/fpp2/seasonal-strength.html" class="uri">https://otexts.com/fpp2/seasonal-strength.html</a>]. In this method the time series is decomposed into trend, seasonal component and remainder:</p>
<p><span class="math display">\[
y_t = T_t + S_t + R_t
\]</span></p>
<p>The strength of the seasonality is described as:</p>
<p><span class="math display">\[
F_S = max(0, 1 - \frac{Var(R_t)}{Var(S_T + R_t)}
\]</span></p>
<p>A rationale behinds this is that for strongly seasonal data the detrended time series should have much more variation than the remainder component has alone.</p>
</div>
<div id="what-kind-of-seasonality" class="section level3" number="4.0.3">
<h3><span class="header-section-number">4.0.3</span> What kind of seasonality?</h3>
<p>Now it is time to answer the question of what period of times do we want to analyse. At first we thought about tracking the sales changes through the week, especially changes between working days and weekends. But let’s plot the bar plot of mean number of sales for every weekday:</p>
<p><img src='images/02_week_seasonality.png'></p>
<p>We were quite surprised by the fact that sales drop every day from Monday to Saturday. We were told by Shumee’s representative that this is because some transaction have the delay between the payment and the confirmation from the bank. That is why some transactions actually made by customers on a weekend are not visible in Shumee’s data until Monday.</p>
<p>So we decided to not analyse the weekly seasonality, becuase the model based on this delayed data could drift far away from real customers behaviour. We think that the best solution is to consider monthly seasonality. Taking longer periods of time evens out the noise of delayed payments. On the other hand monthly seasonality is not so coarse as quaterly seasonality and could potentially capture more subtle patterns.</p>
</div>
<div id="the-most-seasonal-products-1" class="section level3" number="4.0.4">
<h3><span class="header-section-number">4.0.4</span> The most seasonal products</h3>
<p>The groups of products that gained the greatest <span class="math inline">\(F_S\)</span> measure are shown in the table:</p>
<table>
<thead>
<tr class="header">
<th>Name of products group</th>
<th>seasonality</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>strój świętego</td>
<td>0.881225</td>
</tr>
<tr class="even">
<td>szlafrok unisex</td>
<td>0.757613</td>
</tr>
<tr class="odd">
<td>naciągany pokrowiec</td>
<td>0.740653</td>
</tr>
<tr class="even">
<td>siatka ogrodzeniowa</td>
<td>0.721494</td>
</tr>
<tr class="odd">
<td>ostrzałka pił</td>
<td>0.718631</td>
</tr>
<tr class="even">
<td>zestaw wypoczynkowy</td>
<td>0.718409</td>
</tr>
<tr class="odd">
<td>stolik krzesła</td>
<td>0.709425</td>
</tr>
<tr class="even">
<td>ogrodowy stół</td>
<td>0.708391</td>
</tr>
<tr class="odd">
<td>donica gabionowa</td>
<td>0.701651</td>
</tr>
<tr class="even">
<td>ławka wokół</td>
<td>0.700390</td>
</tr>
</tbody>
</table>
<p>Let’s see the sales of <em>strój świętego</em>:</p>
<p><img src="images/02_seasonality_stroj_swietego.png" width="700" style="display: block; margin: auto;" /></p>
<p>Whereas it has perfect seasonal pattern it was sold only 11 times during the whole period of Shumee’s existence. It is too little to train any model, so we should disregard groups that aren’t sold up frequently enough.</p>
<p>Actually, we left only 100 best-selling groups, starting from <em>lampa</em> (4022 sales), <em>elastyczne pokrowce</em> (2680 sales), <em>dywan</em> (2674 sales) and ending with <em>ścianki boczne</em> (204 sales). Among those 100 best-selling products the most seasonal are:</p>
<table>
<thead>
<tr class="header">
<th>Name of products group</th>
<th>seasonality</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>siatka ogrodzeniowa</td>
<td>0.721494</td>
</tr>
<tr class="even">
<td>zestaw wypoczynkowy</td>
<td>0.718409</td>
</tr>
<tr class="odd">
<td>donica gabionowa</td>
<td>0.701651</td>
</tr>
<tr class="even">
<td>zestaw mebli</td>
<td>0.679052</td>
</tr>
<tr class="odd">
<td>parasol ogrodowy</td>
<td>0.669685</td>
</tr>
<tr class="even">
<td>kosz gabionowy</td>
<td>0.658801</td>
</tr>
<tr class="odd">
<td>markiza</td>
<td>0.612309</td>
</tr>
<tr class="even">
<td>klatka dla</td>
<td>0.604560</td>
</tr>
<tr class="odd">
<td>zaczepy do przyczepki</td>
<td>0.592115</td>
</tr>
<tr class="even">
<td>ławka ogrodowa</td>
<td>0.586771</td>
</tr>
</tbody>
</table>
<p>Their respective plots are:</p>
<p><img src="images/02_seasonality_siatka_ogrodzeniowa.png" width="700" style="display: block; margin: auto;" /><img src="images/02_seasonality_zestaw_wypoczynkowy.png" width="700" style="display: block; margin: auto;" /></p>
<p>Visualization of the seasonal component of 20 most seasonal products:</p>
<p><img src="images/02_top_seasonal.png" width="700" style="display: block; margin: auto;" /></p>
<p>It can be seen that almost all of this products were sold the most often between March and August.</p>
<p>Now we choose some of this most seasonal products to train some models for future predictions.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="model-for-predicting-future-sales.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pbiecek/xai_stories_2/edit/master/02-seasonality-analysis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["book.pdf", "book.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
