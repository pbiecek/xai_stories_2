<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Team 5 | XAI Stories 2.0</title>
  <meta name="description" content="eXplainable Artificial Intelligence for Retail Analytics" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Team 5 | XAI Stories 2.0" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/images/cover.png" />
  <meta property="og:description" content="eXplainable Artificial Intelligence for Retail Analytics" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Team 5 | XAI Stories 2.0" />
  
  <meta name="twitter:description" content="eXplainable Artificial Intelligence for Retail Analytics" />
  <meta name="twitter:image" content="/images/cover.png" />



<meta name="date" content="2021-06-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="team-4.html"/>
<link rel="next" href="acknowledgements.html"/>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>




<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><h3>XAI Stories 2.0</h3> Case studies for retail analytics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="foreword.html"><a href="foreword.html"><i class="fa fa-check"></i>Foreword</a><ul>
<li class="chapter" data-level="0.1" data-path="foreword.html"><a href="foreword.html#why"><i class="fa fa-check"></i><b>0.1</b> Why?</a></li>
<li class="chapter" data-level="0.2" data-path="foreword.html"><a href="foreword.html#what"><i class="fa fa-check"></i><b>0.2</b> What?</a></li>
<li class="chapter" data-level="0.3" data-path="foreword.html"><a href="foreword.html#how"><i class="fa fa-check"></i><b>0.3</b> How?</a></li>
<li class="chapter" data-level="0.4" data-path="foreword.html"><a href="foreword.html#about-academic-partners"><i class="fa fa-check"></i><b>0.4</b> About academic partners</a></li>
<li class="chapter" data-level="0.5" data-path="foreword.html"><a href="foreword.html#about-business-partner"><i class="fa fa-check"></i><b>0.5</b> About business partner</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="team-1.html"><a href="team-1.html"><i class="fa fa-check"></i><b>1</b> Team 1</a><ul>
<li class="chapter" data-level="1.1" data-path="team-1.html"><a href="team-1.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="team-1.html"><a href="team-1.html#model"><i class="fa fa-check"></i><b>1.2</b> Model</a></li>
<li class="chapter" data-level="1.3" data-path="team-1.html"><a href="team-1.html#explanations"><i class="fa fa-check"></i><b>1.3</b> Explanations</a></li>
<li class="chapter" data-level="1.4" data-path="team-1.html"><a href="team-1.html#summary-and-conclusions"><i class="fa fa-check"></i><b>1.4</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="team-2.html"><a href="team-2.html"><i class="fa fa-check"></i><b>2</b> Team 2</a><ul>
<li class="chapter" data-level="2.1" data-path="team-2.html"><a href="team-2.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="team-2.html"><a href="team-2.html#model-1"><i class="fa fa-check"></i><b>2.2</b> Model</a></li>
<li class="chapter" data-level="2.3" data-path="team-2.html"><a href="team-2.html#explanations-1"><i class="fa fa-check"></i><b>2.3</b> Explanations</a></li>
<li class="chapter" data-level="2.4" data-path="team-2.html"><a href="team-2.html#summary-and-conclusions-1"><i class="fa fa-check"></i><b>2.4</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="team-3.html"><a href="team-3.html"><i class="fa fa-check"></i><b>3</b> Team 3</a><ul>
<li class="chapter" data-level="3.1" data-path="team-3.html"><a href="team-3.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="team-3.html"><a href="team-3.html#model-2"><i class="fa fa-check"></i><b>3.2</b> Model</a></li>
<li class="chapter" data-level="3.3" data-path="team-3.html"><a href="team-3.html#explanations-2"><i class="fa fa-check"></i><b>3.3</b> Explanations</a></li>
<li class="chapter" data-level="3.4" data-path="team-3.html"><a href="team-3.html#summary-and-conclusions-2"><i class="fa fa-check"></i><b>3.4</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="team-4.html"><a href="team-4.html"><i class="fa fa-check"></i><b>4</b> Team 4</a><ul>
<li class="chapter" data-level="4.1" data-path="team-4.html"><a href="team-4.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="team-4.html"><a href="team-4.html#model-3"><i class="fa fa-check"></i><b>4.2</b> Model</a></li>
<li class="chapter" data-level="4.3" data-path="team-4.html"><a href="team-4.html#explanations-3"><i class="fa fa-check"></i><b>4.3</b> Explanations</a></li>
<li class="chapter" data-level="4.4" data-path="team-4.html"><a href="team-4.html#summary-and-conclusions-3"><i class="fa fa-check"></i><b>4.4</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="team-5.html"><a href="team-5.html"><i class="fa fa-check"></i><b>5</b> Team 5</a><ul>
<li class="chapter" data-level="5.1" data-path="team-5.html"><a href="team-5.html#introduction-4"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="team-5.html"><a href="team-5.html#model-4"><i class="fa fa-check"></i><b>5.2</b> Model</a><ul>
<li class="chapter" data-level="5.2.1" data-path="team-5.html"><a href="team-5.html#dataset-and-pre-processing"><i class="fa fa-check"></i><b>5.2.1</b> Dataset and pre-processing</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="team-5.html"><a href="team-5.html#explanations-4"><i class="fa fa-check"></i><b>5.3</b> Explanations</a><ul>
<li class="chapter" data-level="5.3.1" data-path="team-5.html"><a href="team-5.html#lime"><i class="fa fa-check"></i><b>5.3.1</b> Lime</a></li>
<li class="chapter" data-level="5.3.2" data-path="team-5.html"><a href="team-5.html#shap"><i class="fa fa-check"></i><b>5.3.2</b> Shap</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="team-5.html"><a href="team-5.html#summary-and-conclusions-4"><i class="fa fa-check"></i><b>5.4</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">XAI Stories 2.0</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="team-5" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Team 5</h1>
<p><strong>Embedding-based model for product recommendations.</strong></p>
<p><em>Authors: Andrzej Zapa≈Ça (University of Warsaw), Jakub Modrzewski (University of Warsaw), Piotr Duszak (University of Warsaw)</em></p>
<p><em>Mentors: Jakub Tyrek (McKinsey), Wyszomir Janikowski (McKinsey)</em></p>
<div id="introduction-4" class="section level2">
<h2><span class="header-section-number">5.1</span> Introduction</h2>
<hr />
<p>Global COVID-19 pandemic pushed e-commerce sector to a new heights. While lockdowns froze many classic business models, online sale platforms prospered better than ever. And any e-commerce platform will, likely sooner than later, encounter the need for a recommendation engine of sorts. Regardless of whether its interest lie in groceries, cosmetics, cars, jewellery, or any other product, a common factor will always be the necessity to convince the client to buy more, in the most approachable way possible.</p>
<p>Shumee, a client of McKinsey with whom we've partnered on this project is no exception. During last 3 months we planned, designed, build, perfected and finally delivered a solution based on a state-of-the-art natural language processing and clustering algorithms, which we proudly present below.</p>
</div>
<div id="model-4" class="section level2">
<h2><span class="header-section-number">5.2</span> Model</h2>
<hr />
<div id="dataset-and-pre-processing" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Dataset and pre-processing</h3>
<p>As with any machine-learning related problem, first step is to explore the data, squeeze any useful details and use them to create general plan. Although the dataset itself is confidential, we can share the challenges we've encountered along the way.</p>
<div id="size-structure-and-issues" class="section level4">
<h4><span class="header-section-number">5.2.1.1</span> Size, structure and issues</h4>
<p>From the beginning the task wasn't easy. The dataset we received contained only around 80 000 entries, spanning over 2 years and split across 22 columns. While it may seem like a lot, for an advanced ML model it's not much. To make the matter worse, not all entries were usable - some had to be discarded.</p>
<p>Arguably most important feature, the product name, was filled with multi-lingual (mainly Polish and Czech), raw, unprocessed descriptions. And to make the matter worse, baskets which usually serve as a main backbone for recommendation engine contained in majority 2 products at most.</p>
<p>With no pre-defined categorical structure, small baskets and rich, although somewhat short and noisy product descriptions a general picture of the model was clear - it should create product embeddings with advanced NLP techniques and use them to recommend the most fitting product.</p>
</div>
<div id="ideas-exploration" class="section level4">
<h4><span class="header-section-number">5.2.1.2</span> Ideas &amp; exploration</h4>
<p>During the initial phase of the project multiple models were considered, both for embedding creation and for selection of recommendations based on the forementioned embeddings. As a baseline we've created a naive association-rules model and a bag-of-words (or rather, a bag-of-product-descriptions) tree-based model which treated entire product description &lt;&lt;?&gt;&gt; as a single unique. Unsurprisingly, these models performed poorly (~0.2 % accuracy on the test dataset), yet still above random guess threshold.</p>
<p>---&gt; Lemmatization</p>
<p>---&gt; Experiments?</p>
<p>After the baseline models were trained and established, a more sophisticated solutions had to be considered. In this phase we went over popular NLP embedding creation tools such as TF-IDF and it's variants, GLOVE, GLOVE with TF-IDF, custom LSTM-based method, BERT and others. We also had to come up with a way to group, compare and select the embeddings. After few weeks of experiments we've settled on the following architecture.</p>
</div>
<div id="model-overview" class="section level4">
<h4><span class="header-section-number">5.2.1.3</span> Model overview</h4>
<p>The general idea is as follows:</p>
<ul>
<li>translate features into the high-dimensional embedding space</li>
<li>reduce dimensionality</li>
<li>cluster the results</li>
<li>propose the recommendation based on a custom item-cluster distance function</li>
</ul>
<p>Our model utilizes a beautiful state-of-the-art pre-trained multi-lingual embedding creation method - distiluse-base-multilingual-cased-v2 from the sentence_transformers library - to translate product descriptions into the high-dimensional vector space. Multi-lingual aspect is particularly important, as it allowed us to skip translation and saved possible errors that would result from it. This method works well with both Polish and Czech language.</p>
<p>To reduce dimensionality of the forementioned vector space we used UMAP, and then clustered the results with hdbscan. It's worth mentioning that hdbscan some grey area overhead - a set of items that do not belong to any cluster. In our case this overhead oscillated at around 20%. At this point we were left with 1764 different clusters and a question of how to use them to create recommendations.</p>
<p>&lt;&lt; collaborative filtreing &gt;&gt; ?</p>
<p>&lt;&lt; Distance metric &gt;&gt; - TODO - explain how is the cluster selected</p>
</div>
</div>
</div>
<div id="explanations-4" class="section level2">
<h2><span class="header-section-number">5.3</span> Explanations</h2>
<hr />
<p>We used explanations for two reasons. First to proof our clasterization has sense and also possibly to find some bugs and improve it. We applied two techniques: LIME and SHAP.</p>
<div id="lime" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Lime</h3>
<p>Because LIME needs probabilities we had to invent some method to generate probablities for new items. We tested two: euclidean distances from middles of clusters and votes in KNN classifier. The latter gave better results.</p>
<p>Below you can see first explanation. This is explanation why this two items belongs to this cluster. As you can see main reasons are words &quot;drzwi&quot; and &quot;bambusowy&quot;. And this makes perfect sens. What is worth noticing our clusterization works for polish and czech language.</p>
<p><img src="images/05-Lime_drzwi.jpg" title="Lime dla klastra z drzwiami" /> And there are more such examples. But unfortunatly (or maybe fortunatly) we also found some bad clusters. As you can see in the next picture this time the main reason is &quot;XL&quot; (which is size). Someone could tell &quot;this is good, people with size XL would buy XL clothes&quot;. But we also have here motorcycle cover.</p>
<p><img src="images/05-Lime_XL.jpg" title="Lime dla klastra z XL" /> So we tried improve out clustering by using preprocessing (clearing short words and numbers and lemmatization) on item descriptions. And some clusters are evidently better. This time the most important is &quot;motor&quot; or &quot;motocykl&quot;. What again makes perfect sens.</p>
<div class="figure">
<img src="images/05-Lime_motor.jpg" title="Lime dla klastra z motorami" />

</div>
</div>
<div id="shap" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Shap</h3>
<p>TODO</p>
</div>
</div>
<div id="summary-and-conclusions-4" class="section level2">
<h2><span class="header-section-number">5.4</span> Summary and conclusions</h2>
<hr />
<p>TODO</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="team-4.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="acknowledgements.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pbiecek/xai_stories_2/edit/master/05-example.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["book.pdf", "book.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
