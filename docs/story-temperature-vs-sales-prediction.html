<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Story: Temperature vs sales prediction | XAI Stories 2.0</title>
  <meta name="description" content="eXplainable Artificial Intelligence for Retail Analytics" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Story: Temperature vs sales prediction | XAI Stories 2.0" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/images/cover.png" />
  <meta property="og:description" content="eXplainable Artificial Intelligence for Retail Analytics" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Story: Temperature vs sales prediction | XAI Stories 2.0" />
  
  <meta name="twitter:description" content="eXplainable Artificial Intelligence for Retail Analytics" />
  <meta name="twitter:image" content="/images/cover.png" />



<meta name="date" content="2021-06-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="story-sales-prediction.html"/>
<link rel="next" href="acknowledgements.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>



<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><h3>XAI Stories 2.0</h3> Case studies for retail analytics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="foreword.html"><a href="foreword.html"><i class="fa fa-check"></i>Foreword</a>
<ul>
<li class="chapter" data-level="0.1" data-path="foreword.html"><a href="foreword.html#why"><i class="fa fa-check"></i><b>0.1</b> Why?</a></li>
<li class="chapter" data-level="0.2" data-path="foreword.html"><a href="foreword.html#what"><i class="fa fa-check"></i><b>0.2</b> What?</a></li>
<li class="chapter" data-level="0.3" data-path="foreword.html"><a href="foreword.html#how"><i class="fa fa-check"></i><b>0.3</b> How?</a></li>
<li class="chapter" data-level="0.4" data-path="foreword.html"><a href="foreword.html#about-academic-partners"><i class="fa fa-check"></i><b>0.4</b> About academic partners</a></li>
<li class="chapter" data-level="0.5" data-path="foreword.html"><a href="foreword.html#about-business-partner"><i class="fa fa-check"></i><b>0.5</b> About business partner</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="team-1.html"><a href="team-1.html"><i class="fa fa-check"></i><b>1</b> Team 1</a>
<ul>
<li class="chapter" data-level="1.1" data-path="team-1.html"><a href="team-1.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="team-1.html"><a href="team-1.html#model"><i class="fa fa-check"></i><b>1.2</b> Model</a></li>
<li class="chapter" data-level="1.3" data-path="team-1.html"><a href="team-1.html#explanations"><i class="fa fa-check"></i><b>1.3</b> Explanations</a></li>
<li class="chapter" data-level="1.4" data-path="team-1.html"><a href="team-1.html#summary-and-conclusions"><i class="fa fa-check"></i><b>1.4</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="story-seasonal-products.html"><a href="story-seasonal-products.html"><i class="fa fa-check"></i><b>2</b> Story: Seasonal products</a>
<ul>
<li class="chapter" data-level="2.1" data-path="story-seasonal-products.html"><a href="story-seasonal-products.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="story-seasonal-products.html"><a href="story-seasonal-products.html#the-most-seasonal-products"><i class="fa fa-check"></i><b>2.2</b> The most seasonal products</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="story-seasonal-products.html"><a href="story-seasonal-products.html#data-representation"><i class="fa fa-check"></i><b>2.2.1</b> Data representation</a></li>
<li class="chapter" data-level="2.2.2" data-path="story-seasonal-products.html"><a href="story-seasonal-products.html#seasonality-measure"><i class="fa fa-check"></i><b>2.2.2</b> Seasonality measure</a></li>
<li class="chapter" data-level="2.2.3" data-path="story-seasonal-products.html"><a href="story-seasonal-products.html#what-kind-of-seasonality"><i class="fa fa-check"></i><b>2.2.3</b> What kind of seasonality?</a></li>
<li class="chapter" data-level="2.2.4" data-path="story-seasonal-products.html"><a href="story-seasonal-products.html#the-most-seasonal-products-1"><i class="fa fa-check"></i><b>2.2.4</b> The most seasonal products</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="story-seasonal-products.html"><a href="story-seasonal-products.html#model-for-predicting-future-sales"><i class="fa fa-check"></i><b>2.3</b> Model for predicting future sales</a></li>
<li class="chapter" data-level="2.4" data-path="story-seasonal-products.html"><a href="story-seasonal-products.html#model-explanation"><i class="fa fa-check"></i><b>2.4</b> Model Explanation</a></li>
<li class="chapter" data-level="2.5" data-path="story-seasonal-products.html"><a href="story-seasonal-products.html#data-preprocessing"><i class="fa fa-check"></i><b>2.5</b> Data preprocessing</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="story-embedding-based-model-for-product-recommendations.html"><a href="story-embedding-based-model-for-product-recommendations.html"><i class="fa fa-check"></i><b>3</b> Story: Embedding-based model for product recommendations</a>
<ul>
<li class="chapter" data-level="3.1" data-path="story-embedding-based-model-for-product-recommendations.html"><a href="story-embedding-based-model-for-product-recommendations.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="story-embedding-based-model-for-product-recommendations.html"><a href="story-embedding-based-model-for-product-recommendations.html#model-1"><i class="fa fa-check"></i><b>3.2</b> Model</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="story-embedding-based-model-for-product-recommendations.html"><a href="story-embedding-based-model-for-product-recommendations.html#dataset-and-pre-processing"><i class="fa fa-check"></i><b>3.2.1</b> Dataset and pre-processing</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="story-embedding-based-model-for-product-recommendations.html"><a href="story-embedding-based-model-for-product-recommendations.html#explanations-1"><i class="fa fa-check"></i><b>3.3</b> Explanations</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="story-embedding-based-model-for-product-recommendations.html"><a href="story-embedding-based-model-for-product-recommendations.html#lime"><i class="fa fa-check"></i><b>3.3.1</b> Lime</a></li>
<li class="chapter" data-level="3.3.2" data-path="story-embedding-based-model-for-product-recommendations.html"><a href="story-embedding-based-model-for-product-recommendations.html#shap"><i class="fa fa-check"></i><b>3.3.2</b> Shap</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="story-embedding-based-model-for-product-recommendations.html"><a href="story-embedding-based-model-for-product-recommendations.html#summary-and-conclusions-1"><i class="fa fa-check"></i><b>3.4</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html"><i class="fa fa-check"></i><b>4</b> Story: Sales Prediction</a>
<ul>
<li class="chapter" data-level="4.1" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#data"><i class="fa fa-check"></i><b>4.2</b> Data</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#overview"><i class="fa fa-check"></i><b>4.2.1</b> Overview</a></li>
<li class="chapter" data-level="4.2.2" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#assigning-missing-categories"><i class="fa fa-check"></i><b>4.2.2</b> Assigning missing categories</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#long-term-sales-forecasting"><i class="fa fa-check"></i><b>4.3</b> Long-term sales forecasting</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#model-description"><i class="fa fa-check"></i><b>4.3.1</b> Model description</a></li>
<li class="chapter" data-level="4.3.2" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#model-explanations"><i class="fa fa-check"></i><b>4.3.2</b> Model explanations</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#short-term-sales-forecasting"><i class="fa fa-check"></i><b>4.4</b> Short-term sales forecasting</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#models-description"><i class="fa fa-check"></i><b>4.4.1</b> Models’ description</a></li>
<li class="chapter" data-level="4.4.2" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#results"><i class="fa fa-check"></i><b>4.4.2</b> Results</a></li>
<li class="chapter" data-level="4.4.3" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#models-explanations"><i class="fa fa-check"></i><b>4.4.3</b> Models’ explanations</a></li>
<li class="chapter" data-level="4.4.4" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#why-dont-we-use-short-term-regression-model-instead"><i class="fa fa-check"></i><b>4.4.4</b> Why don’t we use short-term regression model instead</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="story-sales-prediction.html"><a href="story-sales-prediction.html#summary-and-conclusions-2"><i class="fa fa-check"></i><b>4.5</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="story-temperature-vs-sales-prediction.html"><a href="story-temperature-vs-sales-prediction.html"><i class="fa fa-check"></i><b>5</b> Story: Temperature vs sales prediction</a>
<ul>
<li class="chapter" data-level="5.1" data-path="story-temperature-vs-sales-prediction.html"><a href="story-temperature-vs-sales-prediction.html#introduction-4"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="story-temperature-vs-sales-prediction.html"><a href="story-temperature-vs-sales-prediction.html#model-2"><i class="fa fa-check"></i><b>5.2</b> Model</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="story-temperature-vs-sales-prediction.html"><a href="story-temperature-vs-sales-prediction.html#product-categories"><i class="fa fa-check"></i><b>5.2.1</b> Product Categories</a></li>
<li class="chapter" data-level="5.2.2" data-path="story-temperature-vs-sales-prediction.html"><a href="story-temperature-vs-sales-prediction.html#training-and-testing-procedure"><i class="fa fa-check"></i><b>5.2.2</b> Training and testing procedure</a></li>
<li class="chapter" data-level="5.2.3" data-path="story-temperature-vs-sales-prediction.html"><a href="story-temperature-vs-sales-prediction.html#evaluated-models"><i class="fa fa-check"></i><b>5.2.3</b> Evaluated models</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="story-temperature-vs-sales-prediction.html"><a href="story-temperature-vs-sales-prediction.html#explanations-2"><i class="fa fa-check"></i><b>5.3</b> Explanations</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="story-temperature-vs-sales-prediction.html"><a href="story-temperature-vs-sales-prediction.html#instance-level-explanations-2"><i class="fa fa-check"></i><b>5.3.1</b> Instance-level explanations</a></li>
<li class="chapter" data-level="5.3.2" data-path="story-temperature-vs-sales-prediction.html"><a href="story-temperature-vs-sales-prediction.html#model-level-explanations"><i class="fa fa-check"></i><b>5.3.2</b> Model-level explanations</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="story-temperature-vs-sales-prediction.html"><a href="story-temperature-vs-sales-prediction.html#summary-and-conclusions-3"><i class="fa fa-check"></i><b>5.4</b> Summary and conclusions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">XAI Stories 2.0</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="story-temperature-vs-sales-prediction" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 5</span> Story: Temperature vs sales prediction</h1>
<p><em>Authors: Olaf Placha (University of Warsaw), Tomasz Kanas (University of Warsaw), Maciej Twardowski (University of Warsaw), Wiktoria Zapart (University of Łódź)</em></p>
<p><em>Mentors: Alicja Jośko (McKinsey), Maciej Andrzejak (McKinsey)</em></p>
<div id="introduction-4" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Introduction</h2>
<p>A constantly asked question is “How to improve sales?” There are many factors which have an impact on sales. One of them could be weather, which is why in this part we are going to analyse if weather have an actual impact on sales. Thanks to cooperation with Shumme S.A, orders on products of the company were provided as the dataset for this project. In particular, information such as date of the order (all orders were made between 2018 and 2021), country, zip code, product name, volume and price were further used to category selection and model construction. Additionally, dataset was extended by weather information and category of the products. Weather information such as daily average temperature and total daily precipitation were retrieved from the institute of meteorology and water management database. Using first digits of zip code information we divided our data into 10 regions which we matched with accumulated weather data we obtained. In the process of category selection we choose two categories which will be further analyzed and used in model. First group covers products which we can classify as garden product (mostly furniture and accessories), second group covers products which we can classify as home category (also furniture and accessories). We also filtered only these orders which were placed in Poland. Below is an overview of total sales (without splitting into categories), average temperature and precipitation.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-12"></span>
<img src="images/05-sales_temperature_precipitation.png" alt="Daily total sales, average temperature, precipitation in millimeters" width="800" />
<p class="caption">
FIGURE 5.1: Daily total sales, average temperature, precipitation in millimeters
</p>
</div>
<p>An overview of garden products sales and temperature:</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-13"></span>
<img src="images/05-garden_sales.png" alt="Daily garden products sales vs average temperature" width="800" />
<p class="caption">
FIGURE 5.2: Daily garden products sales vs average temperature
</p>
</div>
<p>Beside the description of the data and specification of the problem of this paper, following subjects will be covered:</p>
<ul>
<li>model construction</li>
<li>categories selection</li>
<li>model exploration</li>
<li>instance-level exploration</li>
<li>summary.</li>
</ul>
</div>
<div id="model-2" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Model</h2>
<div id="product-categories" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Product Categories</h3>
<p>One of the first problems we faced was the categorization of products. We did not want to model sales of each product separately, but instead wanted to focus on a smaller number of distinctively different categories. Below was explained the process that led to choosing 2 product categories of which sales were finally modelled: Garden and Home.</p>
<p>Our initial approach was to automatically categorize products using polish word2vec embeddings and run K-Means clustering algorithm on vectorized product names. This proved to be problematic: Setting a small number of clusters (between 5 and 15) resulted in seemingly unrelated products clumped in the same clusters. On the other hand, setting a larger number of clusters resulted in too small number of products in each of them. Time series of total sales of such small ‘categories’ had low values and seemed to contain a lot of noise. Also, inspecting the quality of clusters required a lot of manual work.</p>
<p>This leads to a simpler approach that was actually used: simple categorization of products based on their names containing manually selected keywords. There were 5 predetermined categories: Garden, Home, Clothes, Toy, Industry. If a product name contained a keyword (for example “taras” i.e. terrace in Polish) specific to one of these categories, it was enough to assign category label to it (in this case Garden). In total, there were 187 keywords used, which allowed to categorize 25.000 out of 40.000 product names, responsible for more than 70% of global sales. Moreover, Garden and Home turned out to be responsible for more than 50% of global sales. Since in this project we were interested in the relationship between weather and product sales, they seemed like a great fit. Sales of Garden category products had a distinctive yearly seasonal pattern, unlike Home products.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-14"></span>
<img src="images/05-category-sales.png" alt="Total sales of Garden and Home products" width="700" />
<p class="caption">
FIGURE 5.3: Total sales of Garden and Home products
</p>
</div>
</div>
<div id="training-and-testing-procedure" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Training and testing procedure</h3>
<p>Each model was trained and tested on 12 different train and test datasets. Each training dataset contained data ranging from January 1 2019 to THRESHOLD_DATE. It was then tested on each of 21 next days from THRESHOLD_DATE. These “threshold” dates are marked above on Figure 5.1. They uniformly covered the year 2020. This way of splitting train and test datasets ought to mimic a real-world scenario in which predictive models are retrained periodically and gives a more representative view into models’ performance over the whole year than a single division of data into train, test (and possibly validation) sets. There were some records from the end of 2018 year, but they were discarded due to very small and unstable sales volume values.</p>
<p>As a validation metric we had chosen Median Absolute Error and later on looked at error distributions for 12 train/test datasets and particular models. Median version of this metric was chosen over the “Mean” one due to occasional anomalous sales values occurring in the data which could distort the results.</p>
<p>One of the main benefits of the used metric is its simplicity and interpretability. It’s drawback is that it needs some reference to assess whether obtained values are “good” or “bad”; this reference was provided by evaluating a benchmark model that always predicts no change in daily sales volume.</p>
</div>
<div id="evaluated-models" class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Evaluated models</h3>
<div id="benchmark" class="section level4" number="5.2.3.1">
<h4><span class="header-section-number">5.2.3.1</span> Benchmark</h4>
<p>To obtain some reference to models’ quality metrics, a simple benchmark model was used. This model “predicts” the same daily sales volume as was observed in the current day.</p>
</div>
<div id="arima-fb-prophet-models" class="section level4" number="5.2.3.2">
<h4><span class="header-section-number">5.2.3.2</span> Arima &amp; FB prophet models</h4>
<p>Further, pure time series models were considered, meaning the ones that only used the information of historical daily sales volumes for each of selected categories. These were ARIMA (autoregressive integrated moving average) model and a Generalized Linear Models from FB Prohpet library which incorporates trend, seasonal components and prediction uncertainty.</p>
</div>
<div id="random-forest" class="section level4" number="5.2.3.3">
<h4><span class="header-section-number">5.2.3.3</span> Random Forest</h4>
<p>Finally, we incorporated a model that actually used weather information while predicting the next day’s daily sales volume. This was a Random Forest model that turned out to be the most effective. It used features such as:</p>
<ul>
<li>product category (garden / home)</li>
<li>daily sales volume - today and mean over previous six days</li>
<li>temperature - today and mean over previous six days</li>
<li>precipitation - today and mean over previous six days</li>
<li>day of week</li>
<li>month</li>
<li>region (unused in the final model)</li>
</ul>
<p>Two versions of Random Forest models were evaluated. The first one predicted absolute volume of next day sales and the second one predicted the difference of daily sales volume with respect to the current day. Differencing daily sales volume (as in the second version of the model) removed the trend from the time series; this can be seen below on Figure 5.2</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-15"></span>
<img src="images/05-sales-diffs.png" alt="Differencing daily sales volumes detrends the time series." width="800" />
<p class="caption">
FIGURE 5.4: Differencing daily sales volumes detrends the time series.
</p>
</div>
</div>
<div id="models-effectiveness" class="section level4" number="5.2.3.4">
<h4><span class="header-section-number">5.2.3.4</span> Models’ effectiveness</h4>
<p>The Random Forest models incorporating among others weather information were found to be the most effective. Their Absolute Median Errors were frequently 30-40% lower compared to the benchmark model. Simpler models that used only historical sales volume data were not as good, but still significantly better than the benchmark.</p>
<p>The average Median Absolute Errors (in PLNs) for each model and category are presented below:</p>
<ul>
<li>Detrended Random Forest: ~4300 (Garden), ~4800 (Home)</li>
<li>Random Forest: ~4500 (Garden), ~5000 (Home)</li>
<li>Arima &amp; FB prophet: ~5200 (Garden), ~6500 (Home)</li>
<li>Benchmark: ~6000 (Garden), ~8000 (Home)</li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-16"></span>
<img src="images/05-model-results.png" alt="Distribution of Median Absolute Errors for Garden (up) and Home (down) sales prediction" width="800" />
<p class="caption">
FIGURE 5.5: Distribution of Median Absolute Errors for Garden (up) and Home (down) sales prediction
</p>
</div>
</div>
</div>
</div>
<div id="explanations-2" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Explanations</h2>
<p>Explaining models’ decisions can give valuable insights into what determines the predicted value. Our explanations focused on weather importance. We divided the explanations into instance-level explanations and model-level explanations.</p>
<div id="instance-level-explanations-2" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Instance-level explanations</h3>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-17"></span>
<img src="images/05-shap1.png" alt="SHAP values from one prediction - garden accessories" width="800" />
<p class="caption">
FIGURE 5.6: SHAP values from one prediction - garden accessories
</p>
</div>
<p>Above you can see SHAP values of one of the predictions. It is not surprising that the most influential feature was the mean sales from the previous 6 days. In this case it was substantially above the average. Moreover, moderate total sales from the previous day had a negative impact on the next day’s sales. What is also not very surprising is the fact that the day of the week, which is in this case Tuesday, also reduces expected sales. It aligns with Shumee representatives’ observations, as they usually expect enhanced sales during weekends.</p>
<p>Most importantly, the precipitation and the temperature had a negligible impact on the prediction. But maybe it is because the values were around the average? We definitely need more explanations to answer this question.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-18"></span>
<img src="images/05-shap2.png" alt="SHAP values from one prediction - home accessories" width="800" />
<p class="caption">
FIGURE 5.7: SHAP values from one prediction - home accessories
</p>
</div>
<p>Now you can see another prediction. Contribution of the features to the prediction is similar. Likewise, the weather didn’t impact the predictions substantially. But still, we can not be sure if weather has no impact on most predictions. There were just two examples.</p>
<p>Let’s see how the predictions would change if we tweaked the weather values. To accomplish that we will use Ceteris Paribus Profiles.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-19"></span>
<img src="images/05-cp.png" alt="Ceteris Paribus Profiles of a few features" width="800" />
<p class="caption">
FIGURE 5.8: Ceteris Paribus Profiles of a few features
</p>
</div>
<p>On average, temperature and precipitation prediction is stable as we change the weather values. It lets us be more confident that the weather is not very important in the model’s predictions.</p>
</div>
<div id="model-level-explanations" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Model-level explanations</h3>
<p>To have even more holistic understanding of the weather importance we decided to do model-level explanations. Firstly, we calculated features’ permutational importance. It relied on fixing all features except for one and permuting the not fixed feature’s values. Average absolute percentage difference between the original prediction and the prediction after permutation indicated how important a specific feature is in the predictions.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-20"></span>
<img src="images/05-pi.png" alt="Permutational importance of features in case of home accessories" width="800" />
<p class="caption">
FIGURE 5.9: Permutational importance of features in case of home accessories
</p>
</div>
<p>Above you can see the permutational features importance in case of home accessories. The results are quite consistent with what we have obtained previously - average sales from the last 6 days as well as the day of the week are the most influential.</p>
<p>Finally, we decided to build 3 models with different datasets. They were:
- the original dataset
- the original dataset without weather features
- the original dataset without weather features, with the month number</p>
<p>It turned out that all models performed better than the benchmark, but there were slight performance differences between the models. Namely, the model trained without the weather data, but with the month number, achieved the best score in both home and garden categories. It lets us assume that the weather is just a proxy for the season of the year.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-21"></span>
<img src="images/05-dd.png" alt="Models error when trained with different datasets" width="800" />
<p class="caption">
FIGURE 5.10: Models error when trained with different datasets
</p>
</div>
</div>
</div>
<div id="summary-and-conclusions-3" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Summary and conclusions</h2>
<p>Ability to predict future sales is vital to any retail business. One can use black box machine learning model to compute such predictions, but knowledge what factors contribute to future sales may be even more insightful.</p>
<p>Our task was to assess the impact of temperature on sales prediction. To achieve it, we firstly trained several machine learning models predicting future sales. Then we used few XML techniques to examine effect of weather on our predictions.</p>
<p>Our experiments show little impact of weather on sales predictions. Both variable importance, and local explanation techniques showed some, although small, impact of weather, but model that used month number, instead of temperature and precipitation, achieved similar (even slightly better) results. It suggests, that the impact of weather in our models is mostly caused by a correlation between temperature and month.</p>
<p>There are few possible reasons of such outcome. Firstly, we observe substantial impact of seasonality on sales. Temperature may have impact on this seasonality pattern. For example in one year summer increase in sales may come earlier than in other year, due to higher temperatures. Unfortunately, we had only 2 years of data, which is too short to be able to observe such pattern.</p>
<p>Another possibility is that our model is not good enough to capture the impact of weather. There are many factors that affect sales, like seasonality, day of week or growth of the company. There was also outbreak of COVID-19 pandemic in the middle of examined period, which could affect shopping habits and made it harder to train good model.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="story-sales-prediction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="acknowledgements.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pbiecek/xai_stories_2/edit/master/05-temperature-sales-prediction.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["book.pdf", "book.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
